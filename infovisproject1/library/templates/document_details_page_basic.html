{% extends 'base.html' %}
{% load static %}
{% load range %}

{% block title %}
    <title>Home</title>
{% endblock %}

{% block css %}
    <link rel="stylesheet" type="text/css" href="{% static 'css/detail-page-style.css' %}"/>

{% endblock %}

{% block content %}
    <br>
    <!-- Portfolio Item Heading -->
    {#  <h1 class="my-4">Page Heading#}
    {#    <small>Secondary Text</small>#}
    {#  </h1>#}

    <!-- Portfolio Item Row -->
    <div class="row">

        <div class="col-md-4">
            <img class="img-fluid" src="{{ document.cover.medium }}" width="300px" alt="">
        </div>

        <div class="col-md-8">
            <h3 class="my-3">{{ document.title }}</h3>
            <b>Published: </b><span> {{ document.publish_date }}</span>
            <br>
            <b>Authors: </b>
            <ul>
                {% for author in document.authors %}
                    <li>{{ author.name }}</li>
                {% endfor %}
            </ul>

            <h3 class="my-3">Project Details</h3>
            <ul>
                <li>Lorem Ipsum</li>
                <li>Dolor Sit Amet</li>
                <li>Consectetur</li>
                <li>Adipiscing Elit</li>
            </ul>
        </div>

    </div>
    <!-- /.row -->

    <!-- Related Projects Row -->
    <h3 class="my-4">Explore relevant readings by subject</h3>
    <div>

        {% for subject in document.subjects %}
            {#    accordion div starts#}
            <div class="accordion" id="accordionExample">
                <div class="card">
                    <div class="" id="headingTwo">
                        <h2 class="mb-0" id="subjecttitle{{ subject.name|cut:' ' }}">


                            <button class="btn btn-link collapsed" type="button" data-toggle="collapse"
                                    data-target="#collapseTwo{{ subject.name|cut:' ' }}"
                                    aria-expanded="false" aria-controls="collapseTwo"
                                    onClick="moreInfo('{{ subject.name|replace_space_with_plus }}','{{ subject.name|cut:' ' }}')">
                                {{ subject.name }}
                            </button>

                        </h2>


                    </div>
                    <div id="collapseTwo{{ subject.name|cut:' ' }}" class="collapse"
                         aria-labelledby="headingTwo"
                         data-parent="#accordionExample">
                        <div class="card-body">

                            {#                            loader start#}
                            <div class="spinner-border" id="loadingbardiv{{ subject.name|cut:' ' }}" role="status">
                                <span class="sr-only">Loading...</span>
                            </div>
                            {#                            loader ends#}
                            <div class="row text-center my-slider-class" id="dynamicsubjectdiv{{ subject.name|cut:' ' }}"></div>
                        </div>
                    </div>
                </div>
            </div>
            {#    end of accordion div#}
        {% endfor %}
    </div>

    <div class="row">

        <div class="col-md-3 col-sm-6 mb-4">
            <a href="#">
                <img class="img-fluid" src="http://placehold.it/500x300" alt="">
            </a>
        </div>

        <div class="col-md-3 col-sm-6 mb-4">
            <a href="#">
                <img class="img-fluid" src="http://placehold.it/500x300" alt="">
            </a>
        </div>

        <div class="col-md-3 col-sm-6 mb-4">
            <a href="#">
                <img class="img-fluid" src="http://placehold.it/500x300" alt="">
            </a>
        </div>

        <div class="col-md-3 col-sm-6 mb-4">
            <a href="#">
                <img class="img-fluid" src="http://placehold.it/500x300" alt="">
            </a>
        </div>

    </div>
    <!-- /.row -->

{% endblock %}
<li>a</li>

{% block js %}
    <script>
        function moreInfo(subject, div_suffix) {  /* change 1 - added id parameter*/
            div_id= "#dynamicsubjectdiv"+ div_suffix
            if (!$(div_id).children().length) {
                $.ajax({
                    url: "http://openlibrary.org/search.json?q=" + subject + "&limit=9", /* change 2 - added the id parameter to the api call */
                    dataType: "json",
                    beforeSend: function () {
                        // Show image container
                        $("#loadingbardiv"+div_suffix).show();
                    },
                    success: function (data) {
                        $(div_id).empty();
                        documents = data['docs']
                        for (i = 0; i < documents.length; i++) {
                            $(div_id).append(`<div class="col-lg-3 col-md-6 mb-4">
                    <div class="card h-100">
                        <img class="card-img-top" src="http://covers.openlibrary.org/b/id/` + documents[i]["cover_i"] + `-M.jpg" alt="cannot load image">
                        <div class="card-body p-3">
                            <h4 class="card-title">` + documents[i]["title"] + `</h4>
                            <p class="card-text">Author: def</p>
                        </div>
                        <div class="card-footer">
                            <a href="#" class="btn btn-primary">Find Out More!</a>
                        </div>
                    </div>
                    </div>`);
                        }
                        $("#subjecttitle"+div_suffix).append(`<a href="#" class="previous round" id="prevb`+div_suffix+`">&#8249;</a>
                        <a href="#" class="next round" id="nextb`+div_suffix+`">&#8250;</a>`)
                        $(div_id).slick({
                            infinite: false,
                            slidesToShow: 4,
                            slidesToScroll: 3,
                            arrows: true,
                            dots: true,
                            prevArrow: $('#prevb'+div_suffix),
                            nextArrow: $('#nextb'+div_suffix),
                        });

                    },
                    complete: function (data) {
                        // Hide image container
                        $("#loadingbardiv"+div_suffix).hide();
                    }
                });
            }


        }
    </script>



{% endblock %}





